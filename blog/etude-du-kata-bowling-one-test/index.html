<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="Introduction Dans cette étude de kata, nous allons nous attarder sur une technique clé de TDD, la technique de la triche."><title>Etude du kata bowling (en un seul test)</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://www.ytreza.dev/icon.png><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Source+Sans+Pro:wght@400;600;700&family=Fira+Code:wght@400;700&display=swap" rel=stylesheet><link href=https://www.ytreza.dev/styles.43355a9a8dd6bd19e4e06361fef53dca.min.css rel=stylesheet><script src=https://www.ytreza.dev/js/darkmode.46b07878b7f5d9e26ad7a3c40f8a0605.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script><script>const BASE_URL="https://www.ytreza.dev",fetchData=Promise.all([fetch("https://www.ytreza.dev/indices/linkIndex.82266a23e1f2022d4556ae99a1ca59bc.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://www.ytreza.dev/indices/contentIndex.76df272cb3d2bd3103f8faa3e1e7f618.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n}))</script></head><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://www.ytreza.dev/js/search.bc849b857f2c1b822264d40635bb67b6.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://www.ytreza.dev>Wiki ytreza.dev</a></h1><svg tabindex="0" id="search-icon" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg><div class=spacer></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>Etude du kata bowling (en un seul test)</h1><p class=meta>Last updated May 11, 2022</p><ul class=tags><li><a href=https://www.ytreza.dev/tags/%C3%A9tude-de-kata/>Étude de kata</a></li><li><a href=https://www.ytreza.dev/tags/refactoring/>Refactoring</a></li><li><a href=https://www.ytreza.dev/tags/tricher-avec-tdd/>Tricher avec tdd</a></li><li><a href=https://www.ytreza.dev/tags/clarification/>Clarification</a></li></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#introduction>Introduction</a></li><li><a href=#mise-en-place-du-seul-test>Mise en place du (seul) test</a></li><li><a href=#je-triche-tu-triches-nous-trichons>Je triche, tu triches, nous trichons</a></li><li><a href=#clarifions-quoi--comment->Clarifions&mldr; Quoi ? Comment ?</a></li><li><a href=#clarifions-un-peu-plus>Clarifions un peu plus</a></li><li><a href=#la-classe-bowling->La classe Bowling :</a></li><li><a href=#conclusion>Conclusion</a></li></ol></nav></details></aside><h2 id=introduction>Introduction</h2><p>Dans cette étude de kata, nous allons nous attarder sur une technique clé de <em>TDD</em>, la <strong>technique de la triche</strong>. Cette pratique, qui peut paraître <em>douteuse</em>, est en fait l&rsquo;un des principes fondamentaux qui permet de se laisser guider lorsqu&rsquo;on fait du <em>TDD</em>.</p><p>C&rsquo;est un concept clé de <em>TDD</em>, il est donc <strong>important de bien connaître TDD</strong> avant d&rsquo;utiliser cette technique. Cependant, elle est très intéressante parce qu&rsquo;il y a un côté magique dans cette méthode.</p><p>Cette technique se focalise sur les étapes <strong>GREEN</strong> et <strong>Refactoring</strong> de <em>TDD</em>. C&rsquo;est pourquoi nous allons travailler avec un seul test (amplement suffisant pour cet exercice). Ce ne sera donc pas du TDD traditionnel&mldr; (du TDD avec un seul test ? ce n&rsquo;est pas du TDD, quoique&mldr;).</p><p>La technique permet de <strong>passer de l&rsquo;étape RED à l&rsquo;étape GREEN très rapidement</strong>, nous nous attarderons donc quelques secondes sur ces étapes. Nous passerons par contre plus de temps dans la phase de <strong>Refactoring</strong>, en particulier sur une étape que j&rsquo;appelle la clarification et qui se situe à cheval sur les étapes <strong>GREEN</strong> et <strong>Refactoring</strong>.</p><p>Pour mettre en avant le concept, je te propose le <a href=/kata/bowling rel=noopener class=internal-link data-src=/kata/bowling>kata bowling</a>. Je te conseille de l&rsquo;avoir pratiqué au moins une fois avant de commencer, mais ce n&rsquo;est pas obligatoire.</p><p><strong>Il est très important de noter que je lance l&rsquo;unique test à chaque modification de code pour être sûr que tout fonctionne</strong>. Si tu produis l&rsquo;exercice, il est important que tu le fasses aussi.</p><p>La première étape consiste à mettre en place le test du bowling, je t&rsquo;invite à survoler rapidement cette section si tu connais déjà le kata (mais tu dois au moins étudier le code du test). La partie intéressante commence dans la deuxième partie concernant la triche.</p><p>Enfin, <strong>le code est présenté en mode diff</strong>. Les <code>+</code> indiquent le code qui a été ajouté et les <code>-</code> le code qui a été enlevé.</p><h2 id=mise-en-place-du-seul-test>Mise en place du (seul) test</h2><p>Tout commence donc par un test (le seul test de cette étude).</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl><span class=gi>+import bowling.Bowling;  
</span></span></span><span class=line><span class=cl><span class=gi>+import org.junit.Test;  
</span></span></span><span class=line><span class=cl><span class=gi>+  
</span></span></span><span class=line><span class=cl><span class=gi>+public class TestBowling {  
</span></span></span><span class=line><span class=cl><span class=gi>+  
</span></span></span><span class=line><span class=cl><span class=gi>+    @Test  
</span></span></span><span class=line><span class=cl><span class=gi>+    public void one_game() {  
</span></span></span><span class=line><span class=cl><span class=gi>+        Bowling game = new Bowling();  
</span></span></span><span class=line><span class=cl><span class=gi>+    }  
</span></span></span><span class=line><span class=cl><span class=gi>+  
</span></span></span><span class=line><span class=cl><span class=gi>+}
</span></span></span></code></pre></td></tr></table></div></div><p>Dans l&rsquo;état, nous sommes donc à l&rsquo;étape RED, le test échoue car la classe Bowling n&rsquo;existe pas. Créons donc la classe qui va avec :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl><span class=gi>+package bowling;  
</span></span></span><span class=line><span class=cl><span class=gi>+  
</span></span></span><span class=line><span class=cl><span class=gi>+public class Bowling {  
</span></span></span><span class=line><span class=cl><span class=gi>+}
</span></span></span></code></pre></td></tr></table></div></div><p>Et nous passons au vert.</p><p>Nous allons maintenant jouer au bowling. La méthode <code>roll</code> doit permettre d&rsquo;indiquer le nombre de quilles que l&rsquo;on fait tomber à chaque lancer.</p><p>On rajoute donc au test tous les lancers nécessaires pour faire une partie. Il y a des strikes , des spares, des coups normaux&mldr; Bref, c&rsquo;est le genre de partie que je joue quand je suis chanceux ;)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl><span class=gu>@Test  
</span></span></span><span class=line><span class=cl><span class=gu></span>public void one_game() {  
</span></span><span class=line><span class=cl>    Bowling game = new Bowling();  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=gi>+   game.roll(3);  
</span></span></span><span class=line><span class=cl><span class=gi>+   game.roll(4);  
</span></span></span><span class=line><span class=cl><span class=gi>+   game.roll(6);  
</span></span></span><span class=line><span class=cl><span class=gi>+   game.roll(3);  
</span></span></span><span class=line><span class=cl><span class=gi>+   game.roll(2);  
</span></span></span><span class=line><span class=cl><span class=gi>+   game.roll(8);  
</span></span></span><span class=line><span class=cl><span class=gi>+   game.roll(4);  
</span></span></span><span class=line><span class=cl><span class=gi>+   game.roll(3);  
</span></span></span><span class=line><span class=cl><span class=gi>+   game.roll(4);  
</span></span></span><span class=line><span class=cl><span class=gi>+   game.roll(4);  
</span></span></span><span class=line><span class=cl><span class=gi>+   game.roll(5);  
</span></span></span><span class=line><span class=cl><span class=gi>+   game.roll(2);  
</span></span></span><span class=line><span class=cl><span class=gi>+   game.roll(6);  
</span></span></span><span class=line><span class=cl><span class=gi>+   game.roll(4);  
</span></span></span><span class=line><span class=cl><span class=gi>+   game.roll(10);  
</span></span></span><span class=line><span class=cl><span class=gi>+   game.roll(8);  
</span></span></span><span class=line><span class=cl><span class=gi>+   game.roll(0);  
</span></span></span><span class=line><span class=cl><span class=gi>+   game.roll(10);  
</span></span></span><span class=line><span class=cl><span class=gi>+   game.roll(8);  
</span></span></span><span class=line><span class=cl><span class=gi>+   game.roll(1);  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>Et on passe du <em>RED</em> au <em>GREEN</em> en ajoutant la méthode <code>roll</code> dans la classe <code>Bowling</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>public class Bowling {  
</span></span><span class=line><span class=cl><span class=gi>+    public void roll(int pin) {  
</span></span></span><span class=line><span class=cl><span class=gi>+  
</span></span></span><span class=line><span class=cl><span class=gi>+    }  
</span></span></span><span class=line><span class=cl><span class=gi></span>}
</span></span></code></pre></td></tr></table></div></div><p>Enfin, on vérifie que le score calculé est le bon :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl><span class=gu>@Test  
</span></span></span><span class=line><span class=cl><span class=gu></span>public void one_game() {  
</span></span><span class=line><span class=cl>    Bowling game = new Bowling();  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    game.roll(3);  
</span></span><span class=line><span class=cl>    game.roll(4);  
</span></span><span class=line><span class=cl>    game.roll(6);  
</span></span><span class=line><span class=cl>    game.roll(3);  
</span></span><span class=line><span class=cl>    game.roll(2);  
</span></span><span class=line><span class=cl>    game.roll(8);  
</span></span><span class=line><span class=cl>    game.roll(4);  
</span></span><span class=line><span class=cl>    game.roll(3);  
</span></span><span class=line><span class=cl>    game.roll(4);  
</span></span><span class=line><span class=cl>    game.roll(4);  
</span></span><span class=line><span class=cl>    game.roll(5);  
</span></span><span class=line><span class=cl>    game.roll(2);  
</span></span><span class=line><span class=cl>    game.roll(6);  
</span></span><span class=line><span class=cl>    game.roll(4);  
</span></span><span class=line><span class=cl>    game.roll(10);  
</span></span><span class=line><span class=cl>    game.roll(8);  
</span></span><span class=line><span class=cl>    game.roll(0);  
</span></span><span class=line><span class=cl>    game.roll(10);  
</span></span><span class=line><span class=cl>    game.roll(8);  
</span></span><span class=line><span class=cl>    game.roll(1);  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=gi>+   Assert.assertEquals(117, game.score());  
</span></span></span><span class=line><span class=cl><span class=gi></span>}
</span></span></code></pre></td></tr></table></div></div><p>On tombe sur une erreur de compilation (étape <em>RED</em>), on crée la méthode <code>score</code> et on fait échouer l&rsquo;assert (toujours <em>RED</em>):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>public class Bowling {  
</span></span><span class=line><span class=cl>    public void roll(int pin) {  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    }  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=gi>+   public int score() {  
</span></span></span><span class=line><span class=cl><span class=gi>+       return -1;  
</span></span></span><span class=line><span class=cl><span class=gi>+   }  
</span></span></span><span class=line><span class=cl><span class=gi></span>}
</span></span></code></pre></td></tr></table></div></div><p>Et voilà, on peut rentrer dans le vif du sujet, on a fini de mettre en place nos tests. Nous allons pouvoir tricher allègrement.</p><h2 id=je-triche-tu-triches-nous-trichons>Je triche, tu triches, nous trichons</h2><p>Le passage au vert se fait de la manière la plus simple, en indiquant le résultat attendu.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>public int score() {  
</span></span><span class=line><span class=cl><span class=gd>-   return -1;  	
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   return 117;  
</span></span></span><span class=line><span class=cl><span class=gi></span>}  
</span></span></code></pre></td></tr></table></div></div><p>On passe de l&rsquo;étape <em>RED</em> à l&rsquo;étape <em>GREEN</em> en 2 secondes. Voilà, nous venons de pratiquer ce que j&rsquo;appelle la <strong>triche</strong>. Indiquer directement dans le code le résultat attendu.</p><p>À partir de maintenant, nos tests doivent toujours passer. Nous entrons dans la phase du <em>REFACTORING</em>. Et nous n&rsquo;en ressortirons pas tant que notre algo ne sera pas terminé.</p><h2 id=clarifions-quoi--comment->Clarifions&mldr; Quoi ? Comment ?</h2><blockquote><ul><li>Novice : C&rsquo;est bien beau ce 117, mais je ne vois pas d&rsquo;algo là-dedans</li><li>Expert : C&rsquo;est vrai, mais pourtant, l&rsquo;algo est là, mais tu ne le vois pas encore</li><li>Novice : ???</li><li>Expert : Petite question, c&rsquo;est quoi ce 117 ?</li><li>Novice : 117 ? C&rsquo;est le score total de ma partie de bowling&mldr;</li></ul></blockquote><p>Bingo ! Nous venons d&rsquo;attaquer la phase de <strong>clarification</strong> qui est une étape de la phase de <em>REFACTORING</em>. Nous sommes en train de parler du <strong>QUOI</strong>. Et cela nous permet d&rsquo;introduire un nouveau concept : le score total de la partie (bon, je sais, la méthode s&rsquo;appelle score, c&rsquo;était facile&mldr;).</p><p>Mettons en évidence ce nouveau concept, à l&rsquo;aide d&rsquo;un [[wiki/extract variable|extract variable ]]:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>public int score() {  
</span></span><span class=line><span class=cl><span class=gd>-   return 117;  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   int score = 117;  
</span></span></span><span class=line><span class=cl><span class=gi>+   return score;  
</span></span></span><span class=line><span class=cl><span class=gi></span>}
</span></span></code></pre></td></tr></table></div></div><blockquote><ul><li>Novice : Tu as toujours ce 117&mldr;</li><li>Expert : C&rsquo;est vrai, mais comment arrive-t-on à ce résultat ?</li><li>Novice : Il faut ajouter le résultat du premier lancer puis du second &mldr;.</li><li>Expert : C&rsquo;est vrai, mais ton niveau d&rsquo;abstraction est trop haut, c&rsquo;est trop tôt pour en parler</li><li>Novice : ???</li><li>Expert : Le résultat du premier lancer, c&rsquo;est 3 et le second, c&rsquo;est 4</li><li>Novice ???????</li><li>Expert : 117, c&rsquo;est égal à 3 + 4 + 6 + &mldr; + 10 + 8 + 1</li><li>Novice : ?????????????????????</li><li>Expert : Oui, pour calculer le score, il faut connaître les règles du bowling et savoir faire le calcul à la main</li></ul></blockquote><p>Si on traduit cela en code, ça nous donne. En guide d&rsquo;exercice, tu peux repartir de notre jeu de test et voir comment on calcule cela :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>public int score() {  
</span></span><span class=line><span class=cl><span class=gd>-   int score = 117;  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   int score = 3 + 4 + 6 + 3 + 2 + 8 + 4 + 4 + 3 + 4 + 4 + 5 + 2 + 6 + 4 + 10 + 10 + 8 + 0 + 8 + 0 + 10 + 8 + 1;  
</span></span></span><span class=line><span class=cl><span class=gi></span>    return score;  
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>Pour réussir cela, nous avons introduit la notion de <strong>COMMENT</strong>. Mais attention, il ne faut pas changer de niveau d&rsquo;abstraction trop rapidement. Si c&rsquo;est possible, on introduit l&rsquo;un après l&rsquo;autre.</p><p>Organisons un peu le code pour faire apparaître le <strong>QUOI</strong>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>public int score() {  
</span></span><span class=line><span class=cl><span class=gd>-   int score = 3 + 4 + 6 + 3 + 2 + 8 + 4 + 4 + 3 + 4 + 4 + 5 + 2 + 6 + 4 + 10 + 10 + 8 + 0 + 8 + 0 + 10 + 8 + 1;  
</span></span></span><span class=line><span class=cl><span class=gd></span>
</span></span><span class=line><span class=cl><span class=gi>+   int score = 0;  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl><span class=gi>+   score += 3;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += 4; 
</span></span></span><span class=line><span class=cl><span class=gi>+   score += 6;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += 3;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += 2;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += 8;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += 4;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += 4;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += 3;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += 4;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += 4;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += 5;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += 2;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += 6;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += 4;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += 10;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += 10;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += 8;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += 0;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += 8;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += 0;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += 10;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += 8;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += 1;  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    return score;  
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>Et encore une étape (pour rappel, le test passe toujours) :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>public int score() {  
</span></span><span class=line><span class=cl>    int score = 0;  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=gi>+   // frame 1  
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += 3; // roll 1  
</span></span><span class=line><span class=cl>    score += 4; // roll 2  
</span></span><span class=line><span class=cl>	  
</span></span><span class=line><span class=cl><span class=gi>+   // frame 2  
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += 6; // roll 3  
</span></span><span class=line><span class=cl>    score += 3; // roll 4  
</span></span><span class=line><span class=cl>	  
</span></span><span class=line><span class=cl><span class=gi>+   // frame 3  
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += 2; // roll 5  
</span></span><span class=line><span class=cl>    score += 8; // roll 6 (spare)  
</span></span><span class=line><span class=cl>    score += 4; // roll 7 (spare bonus)  
</span></span><span class=line><span class=cl>	  
</span></span><span class=line><span class=cl><span class=gi>+   // frame 4  
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += 4; // roll 7  
</span></span><span class=line><span class=cl>    score += 3; // roll 8  
</span></span><span class=line><span class=cl>	  
</span></span><span class=line><span class=cl><span class=gi>+   // frame 5  
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += 4; // roll 9  
</span></span><span class=line><span class=cl>    score += 4; // roll 10  
</span></span><span class=line><span class=cl>	  
</span></span><span class=line><span class=cl><span class=gi>+   // frame 6  
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += 5; // roll 11  
</span></span><span class=line><span class=cl>    score += 2; // roll 12  
</span></span><span class=line><span class=cl>	  
</span></span><span class=line><span class=cl><span class=gi>+   // frame 7  
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += 6; // roll 13  
</span></span><span class=line><span class=cl>    score += 4; // roll 14 (spare) 
</span></span><span class=line><span class=cl>    score += 10; // roll 15 (spare bonus)   
</span></span><span class=line><span class=cl>	  
</span></span><span class=line><span class=cl><span class=gi>+   // frame 8  
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += 10; // roll 15 (strike)  
</span></span><span class=line><span class=cl>    score += 8; // roll 16 (strike bonus)  
</span></span><span class=line><span class=cl>    score += 0; // roll 17 (strike bonus)  
</span></span><span class=line><span class=cl>	  	  
</span></span><span class=line><span class=cl><span class=gi>+   // frame 9  
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += 8; // roll 16  
</span></span><span class=line><span class=cl>    score += 0; // roll 17   
</span></span><span class=line><span class=cl>	  
</span></span><span class=line><span class=cl><span class=gi>+   // frame 10  
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += 10; // roll 18 (strike)  
</span></span><span class=line><span class=cl>    score += 8; // roll 19 (strike bonus)  
</span></span><span class=line><span class=cl>    score += 1; // roll 20 (strike bonus)
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    return score;  
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>En séparant les différents lancers, nous faisons apparaître la notion de <em>frame</em>, l&rsquo;un des concepts du bowling. Nous introduisons aussi la notion de strike et de spare ainsi que les bonus respectif.</p><h2 id=clarifions-un-peu-plus>Clarifions un peu plus</h2><blockquote><ul><li>Novice : tu veux encore clarifier ?</li><li>Expert : oui, mais cette fois, c&rsquo;est pour enlever de la duplication</li><li>Novice : de la duplication ??</li><li>Expert : oui, ces nombres : 3, 4, 6, etc&mldr; on les retrouve aussi dans le test</li><li>Novice : ah oui, c&rsquo;est vrai&mldr; et je suppose que ce sont les mêmes concepts ?</li><li>Expert : oui, chaque nombre représente le nombre de quilles tombées lors d&rsquo;un lancer.</li></ul></blockquote><p>Allons chercher ces lancers. Ils sont définis dans le test et sont introduits dans notre classe via la méthode <code>roll</code>.</p><p>Pour les avoir à disposition dans notre méthode <code>score</code>, nous devons les stocker dans un attribut :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>public class Bowling {  
</span></span><span class=line><span class=cl><span class=gi>+   List&lt;Integer&gt; rolls = new ArrayList&lt;&gt;();  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl><span class=gi>+   public void roll(int pins) {  
</span></span></span><span class=line><span class=cl><span class=gi>+       rolls.add(pins);  
</span></span></span><span class=line><span class=cl><span class=gi>+   }  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    public int score() {  
</span></span><span class=line><span class=cl>        int score = 0;  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>        // frame 1  
</span></span><span class=line><span class=cl>        score += 3;  
</span></span><span class=line><span class=cl>        score += 4;  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>       // ...
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>        // frame 10
</span></span><span class=line><span class=cl>        score += 10;  
</span></span><span class=line><span class=cl>        score += 8;  
</span></span><span class=line><span class=cl>        score += 1;  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>        return score;  
</span></span><span class=line><span class=cl>    }  
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>Nous allons maintenant pouvoir les utiliser :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>public int score() {  
</span></span><span class=line><span class=cl>    int score = 0;  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 1  
</span></span><span class=line><span class=cl><span class=gd>-   score += 3; // roll 1  
</span></span></span><span class=line><span class=cl><span class=gd>-   score += 4; // roll 2      
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   score += rolls.get(0); // roll 1  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(1); // roll 2  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    // frame 2
</span></span><span class=line><span class=cl><span class=gd>-   score += 6; // roll 3  
</span></span></span><span class=line><span class=cl><span class=gd>-   score += 3; // roll 4    
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   score += rolls.get(2); // roll 3  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(3); // roll 4  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    // frame 3
</span></span><span class=line><span class=cl><span class=gd>-   score += 2; // roll 5  
</span></span></span><span class=line><span class=cl><span class=gd>-   score += 8; // roll 6 (spare)  
</span></span></span><span class=line><span class=cl><span class=gd>-   score += 4; // roll 7 (spare bonus)      
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   score += rolls.get(4); // roll 5  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(5); // roll 6 (spare)  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(6); // roll 7 (spare bonus)  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    // frame 4
</span></span><span class=line><span class=cl><span class=gd>-   score += 4; // roll 7  
</span></span></span><span class=line><span class=cl><span class=gd>-   score += 3; // roll 8     
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   score += rolls.get(6); // roll 7  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(7); // roll 8  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    // frame 5
</span></span><span class=line><span class=cl><span class=gd>-   score += 4; // roll 9  
</span></span></span><span class=line><span class=cl><span class=gd>-   score += 4; // roll 10    
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   score += rolls.get(8); // roll 9  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(9); // roll 10  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    // frame 6
</span></span><span class=line><span class=cl><span class=gd>-   score += 5; // roll 11  
</span></span></span><span class=line><span class=cl><span class=gd>-   score += 2; // roll 12          
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+     score += rolls.get(10); // roll 11  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(11); // roll 12  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    // frame 7
</span></span><span class=line><span class=cl><span class=gd>-   score += 6; // roll 13  
</span></span></span><span class=line><span class=cl><span class=gd>-   score += 4; // roll 14 (spare) 
</span></span></span><span class=line><span class=cl><span class=gd>-   score += 10; // roll 15 (spare bonus)       
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+     score += rolls.get(12); // roll 13  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(13); // roll 14 (spare)  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(14); // roll 15 (spare bonus)    
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    // frame 8
</span></span><span class=line><span class=cl><span class=gd>-   score += 10; // roll 15 (strike)  
</span></span></span><span class=line><span class=cl><span class=gd>-   score += 8; // roll 16 (strike bonus)  
</span></span></span><span class=line><span class=cl><span class=gd>-   score += 0; // roll 17 (strike bonus)      
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   score += rolls.get(14); // roll 15 (strike)  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(15); // roll 16 (strike bonus)  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(16); // roll 17 (strike bonus)  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 9
</span></span><span class=line><span class=cl><span class=gd>-   score += 8; // roll 16  
</span></span></span><span class=line><span class=cl><span class=gd>-   score += 0; // roll 17      
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   score += rolls.get(15); // roll 16  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(16); // roll 17  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 10
</span></span><span class=line><span class=cl><span class=gd>-   score += 10; // roll 18 (strike)  
</span></span></span><span class=line><span class=cl><span class=gd>-   score += 8; // roll 19 (strike bonus)  
</span></span></span><span class=line><span class=cl><span class=gd>-   score += 1; // roll 20 (strike bonus)-   
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   score += rolls.get(17); // roll 18 (strike)  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(18); // roll 19 (strike bonus)  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(19); // roll 20 (strike bonus)  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    return score;  
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><blockquote><ul><li>Novice : Et maintenant ? On fait quoi ?</li><li>Expert : On continue d&rsquo;enlever la duplication !</li><li>Novice : À part le rolls.get, je n&rsquo;en vois pas&mldr;</li><li>Expert : C&rsquo;est pourquoi nous allons la mettre en évidence</li></ul></blockquote><p>Pour mettre en évidence la duplication, il faut se servir de son instinct. Il n&rsquo;y a pas de règle permettant d&rsquo;y arriver, mais je te propose ça :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>public int score() {  
</span></span><span class=line><span class=cl>    int score = 0;  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 1  
</span></span><span class=line><span class=cl>    score += rolls.get(0); // roll 1  
</span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(1); // roll 2  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   score += rolls.get(0 + 1); // roll 2  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    // frame 2
</span></span><span class=line><span class=cl>    score += rolls.get(2); // roll 3  
</span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(3); // roll 4  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   score += rolls.get(2 + 1); // roll 4  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    // frame 3
</span></span><span class=line><span class=cl>    score += rolls.get(4); // roll 5  
</span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(5); // roll 6 (spare)  
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(6); // roll 7 (spare bonus)  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   score += rolls.get(4 + 1); // roll 6 (spare)  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(4 + 2); // roll 7 (spare bonus)  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    // frame 4    
</span></span><span class=line><span class=cl>    score += rolls.get(6); // roll 7  
</span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(7); // roll 8  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   score += rolls.get(6 + 1); // roll 8  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    // frame 5    
</span></span><span class=line><span class=cl>    score += rolls.get(8); // roll 9  
</span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(9); // roll 10  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   score += rolls.get(8 + 1); // roll 10  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    // frame 6    
</span></span><span class=line><span class=cl>    score += rolls.get(10); // roll 11  
</span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(11); // roll 12  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   score += rolls.get(10 + 1); // roll 12  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    // frame 7    
</span></span><span class=line><span class=cl>    score += rolls.get(12); // roll 13  
</span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(13); // roll 14  
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(14); // roll 15  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   score += rolls.get(12 + 1); // roll 14  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(12 + 2); // roll 15  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    // frame 8    
</span></span><span class=line><span class=cl>    score += rolls.get(14); // roll 15 (strike)  
</span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(15); // roll 16 (strike bonus)  
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(16); // roll 17 (strike bonus)  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   score += rolls.get(14 + 1); // roll 16 (strike bonus)  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(14 + 2); // roll 17 (strike bonus)  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 9    
</span></span><span class=line><span class=cl>    score += rolls.get(15); // roll 16
</span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(16); // roll 17        
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   score += rolls.get(15 + 1); // roll 17  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 10    
</span></span><span class=line><span class=cl>    score += rolls.get(17); // roll 18 (strike) 
</span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(18); // roll 19 (strike bonus)  
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(19); // roll 20 (strike bonus)  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   score += rolls.get(17 + 1); // roll 19 (strike bonus)  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(17 + 2); // roll 20 (strike bonus)  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    return score;  
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>J&rsquo;exprime l&rsquo;indice de chaque lancer en fonction du premier lancer du frame. Ce qui va nous permettre d&rsquo;introduire la notion de <em>frame index</em>. Chaque <em>frame</em> commence à son premier lancer. Le <em>frame index</em> correspond à l&rsquo;index de ce lancer. Voyons voir ce que ça donne :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>public int score() {  
</span></span><span class=line><span class=cl>    int score = 0;  
</span></span><span class=line><span class=cl><span class=gi>+   int frameIndex = 0;  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    // frame 1  
</span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(0); // roll 1
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(0 + 1); // roll 2
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = 0;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(frameIndex); // roll 1  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(frameIndex + 1); // roll 2  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    // frame 2   
</span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(2); // roll 3
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(2 + 1); // roll 4
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = 2;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(frameIndex); // roll 3  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(frameIndex + 1); // roll 4  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    // frame 3
</span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(4); // roll 5
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(4 + 1); // roll 6 (spare)
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(4 + 2); // roll 7 (spare bonus)    
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = 4;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(frameIndex); // roll 5  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(frameIndex + 1); // roll 6 (spare)  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(frameIndex + 2); // roll 7 (spare bonus)  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    // frame 4    
</span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(6); // roll 7
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(6 + 1); // roll 8    
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = 6;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(frameIndex); // roll 7  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(frameIndex + 1); // roll 8  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    // frame 5    
</span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(8); // roll 9
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(8 + 1); // roll 10    
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = 8;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(frameIndex); // roll 9  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(frameIndex + 1); // roll 10  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    // frame 6    
</span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(10); // roll 11
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(10 + 1); // roll 12
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = 10;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(frameIndex); // roll 11  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(frameIndex + 1); // roll 12  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    // frame 7    
</span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(12); // roll 13
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(12 + 1); // roll 14
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(12 + 2); // roll 15    
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = 12;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(frameIndex); // roll 13  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(frameIndex + 1); // roll 14  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(frameIndex + 2); // roll 15  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    // frame 8   
</span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(14); // roll 15 (strike)
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(14 + 1); // roll 16 (strike bonus)
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(14 + 2); // roll 17 (strike bonus)
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = 14;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(frameIndex); // roll 15 (strike)  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(frameIndex + 1); // roll 16 (strike bonus)  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(frameIndex + 2); // roll 17 (strike bonus)  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 9    
</span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(15); // roll 16
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(15 + 1); // roll 17    
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = 15;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(frameIndex); // roll 16  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(frameIndex + 1); // roll 17  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 10    
</span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(17); // roll 18 (strike)
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(17 + 1); // roll 19 (strike bonus)
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(17 + 2); // roll 20 (strike bonus)
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = 17;  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(frameIndex); // roll 18 (strike)  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(frameIndex + 1); // roll 19 (strike bonus)  
</span></span></span><span class=line><span class=cl><span class=gi>+   score += rolls.get(frameIndex + 2); // roll 20 (strike bonus)  
</span></span></span><span class=line><span class=cl><span class=gi></span>  
</span></span><span class=line><span class=cl>    return score;  
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><blockquote><ul><li>Novice : Ah oui ! Je la vois maintenant. On fait une boucle ?</li><li>Expert : Ton instinct te dit qu&rsquo;il y a une boucle, mais c&rsquo;est encore trop tôt.</li><li>Novice : Pourquoi ? Les blocs se ressemblent !</li><li>Expert : Ils se ressemblent, mais ils ne sont pas identiques. Il faut continuer à clarifier.</li><li>Novice : Qu&rsquo;est-ce qu&rsquo;on fait alors ?</li><li>Expert : Ce que l&rsquo;on fait depuis le début, on clarifie puis on met en évidence la duplication.</li></ul></blockquote><p>Effectivement, il est trop tôt pour introduire une boucle. Clarifions le concept de <code>frameIndex</code> :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>public int score() {  
</span></span><span class=line><span class=cl>    int score = 0;  
</span></span><span class=line><span class=cl>    int frameIndex = 0;  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 1  
</span></span><span class=line><span class=cl>    frameIndex = 0;  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 1  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 2  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 2   
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = 2;  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = 0 + 2;  
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += rolls.get(frameIndex); // roll 3  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 4  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 3
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = 4;  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = 2 + 2;  
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += rolls.get(frameIndex); // roll 5  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 6 (spare)  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 2); // roll 7 (spare bonus)  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 4    
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = 6;  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = 4 + 2;  
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += rolls.get(frameIndex); // roll 7  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 8  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 5    
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = 8;  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = 6 + 2;    
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += rolls.get(frameIndex); // roll 9  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 10  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 6    
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = 10;  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = 8 + 2;  
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += rolls.get(frameIndex); // roll 11  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 12  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 7    
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = 12;  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = 10 + 2;  
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += rolls.get(frameIndex); // roll 13  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 14  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 2); // roll 15  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 8   
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = 14;  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = 12 + 2;  
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += rolls.get(frameIndex); // roll 15 (strike)  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 16 (strike bonus)  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 2); // roll 17 (strike bonus)  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 9    
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = 15;
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = 14 + 1;  
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += rolls.get(frameIndex); // roll 16  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 17  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 10    
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = 17;  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = 15 + 2;  
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += rolls.get(frameIndex); // roll 18 (strike)  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 19 (strike bonus)  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 2); // roll 20 (strike bonus)  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    return score;  
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>Puis mettons en évidence la duplication :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>public int score() {  
</span></span><span class=line><span class=cl>    int score = 0;  
</span></span><span class=line><span class=cl>    int frameIndex = 0;  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 1  
</span></span><span class=line><span class=cl>    frameIndex = 0;  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 1  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 2  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 2   
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = 0 + 2;  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = frameIndex + 2;  
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += rolls.get(frameIndex); // roll 3  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 4  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 3
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = 2 + 2;  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = frameIndex + 2;  
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += rolls.get(frameIndex); // roll 5  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 6 (spare)  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 2); // roll 7 (spare bonus)  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 4    
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = 4 + 2;  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = frameIndex + 2;  
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += rolls.get(frameIndex); // roll 7  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 8  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 5    
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = 6 + 2;    
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = frameIndex + 2;    
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += rolls.get(frameIndex); // roll 9  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 10  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 6    
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = 8 + 2;  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = frameIndex + 2;  
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += rolls.get(frameIndex); // roll 11  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 12  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 7    
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = 10 + 2;  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = frameIndex + 2;  
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += rolls.get(frameIndex); // roll 13  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 14  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 2); // roll 15  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 8   
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = 12 + 2;  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = frameIndex + 2;  
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += rolls.get(frameIndex); // roll 15 (strike)  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 16 (strike bonus)  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 2); // roll 17 (strike bonus)  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 9    
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = 14 + 1;  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = frameIndex + 1;  
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += rolls.get(frameIndex); // roll 16  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 17  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    // frame 10    
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = 15 + 2;  
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   frameIndex = frameIndex + 2;  
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += rolls.get(frameIndex); // roll 18 (strike)  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 19 (strike bonus)  
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 2); // roll 20 (strike bonus)  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    return score;  
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><blockquote><ul><li>Novice : Et ensuite ?</li><li>Expert : On va continuer de clarifier en introduisant la notion de bonus. On va de nouveau utiliser le refactoring Extract variable.</li></ul></blockquote><p>La notion de bonus apparaît lorsqu&rsquo;on a un <em>strike</em> (les deux prochains lancers sont ajoutés en bonus) ou lors d&rsquo;un <em>spare</em> (le prochain lancer est ajouté en bonus). On va donc faire un extract variable sur ce calcul pour faire apparaître le concept.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>public int score() {
</span></span><span class=line><span class=cl>    int score = 0;
</span></span><span class=line><span class=cl>    int frameIndex = 0;
</span></span><span class=line><span class=cl><span class=gi>+   int bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gi></span>    
</span></span><span class=line><span class=cl>    // frame 1
</span></span><span class=line><span class=cl>    frameIndex = 0;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 1
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 2
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 3
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 4
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 3
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 5
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 6 (spare)
</span></span><span class=line><span class=cl>    bonus = rolls.get(frameIndex + 2); // roll 7 (spare bonus)
</span></span><span class=line><span class=cl>    score += bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 4
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 7
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 8
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 5
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 9
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 10
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 6
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 11
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 12
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 7
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 13
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 14 (spare)
</span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(frameIndex + 2); // roll 15 (spare bonus)
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   bonus = rolls.get(frameIndex + 2); // roll 15 (spare bonus)
</span></span></span><span class=line><span class=cl><span class=gi>+   score += bonus;
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl>    // frame 8
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 15 (strike)
</span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(frameIndex + 1); // roll 16 (strike bonus)
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(frameIndex + 2); // roll 17 (strike bonus)
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   bonus = rolls.get(frameIndex + 1); // roll 16 (strike bonus)
</span></span></span><span class=line><span class=cl><span class=gi>+   bonus += rolls.get(frameIndex + 2); // roll 17 (strike bonus)
</span></span></span><span class=line><span class=cl><span class=gi>+   score += bonus;
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl>    // frame 9
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 1;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 16
</span></span><span class=line><span class=cl>     score += rolls.get(frameIndex + 1); // roll 17
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 10
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 18 (strike)
</span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(frameIndex + 1); // roll 19 (strike bonus)
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(frameIndex + 2); // roll 20 (strike bonus)
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   bonus = rolls.get(frameIndex + 1); // roll 19 (strike bonus)
</span></span></span><span class=line><span class=cl><span class=gi>+   bonus += rolls.get(frameIndex + 2); // roll 20 (strike bonus)
</span></span></span><span class=line><span class=cl><span class=gi>+   score += bonus;
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl>   return score;
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><blockquote><ul><li>Novice : C&rsquo;est bien beau ce concept de bonus, mais on ne les voit pas dans tous les blocs !</li><li>Expert : Et donc ?</li><li>Novice : Les blocs se ressemblent moins après ta modification !</li><li>Expert : Tu as tout à fait raison, mais rien ne nous interdit d&rsquo;introduire la notion de bonus pour les frames standard</li></ul></blockquote><p>En effet, nous avons un concept qui n&rsquo;apparait que dans certains cas. Ce concept est assez simple et peut-être représenté dans notre algorithme.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>    public int score() {
</span></span><span class=line><span class=cl>    int score = 0;
</span></span><span class=line><span class=cl>    int frameIndex = 0;
</span></span><span class=line><span class=cl>    int bonus = 0;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 1
</span></span><span class=line><span class=cl>    frameIndex = 0;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 1
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 2
</span></span><span class=line><span class=cl><span class=gi>+   bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gi>+   score += bonus;
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl>    // frame 2
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 3
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 4
</span></span><span class=line><span class=cl><span class=gi>+   bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gi>+   score += bonus;
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl>    // frame 3
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 5
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 6 (spare)
</span></span><span class=line><span class=cl>    bonus = rolls.get(frameIndex + 2); // roll 7 (spare bonus)
</span></span><span class=line><span class=cl>    score += bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 4
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 7
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 8
</span></span><span class=line><span class=cl><span class=gi>+   bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gi>+   score += bonus;
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl>    // frame 5
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 9
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 10
</span></span><span class=line><span class=cl><span class=gi>+   bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gi>+   score += bonus;
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl>    // frame 6
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 11
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 12
</span></span><span class=line><span class=cl><span class=gi>+   bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gi>+   score += bonus;
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl>    // frame 7
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 13
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 14 (spare)
</span></span><span class=line><span class=cl>    bonus = rolls.get(frameIndex + 2); // roll 15 (spare bonus)
</span></span><span class=line><span class=cl>    score += bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 8
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 15 (strike)
</span></span><span class=line><span class=cl>    bonus = rolls.get(frameIndex + 1); // roll 16 (strike bonus)
</span></span><span class=line><span class=cl>    bonus += rolls.get(frameIndex + 2); // roll 17 (strike bonus)
</span></span><span class=line><span class=cl>    score += bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 9
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 1;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 16
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 17
</span></span><span class=line><span class=cl><span class=gi>+   bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gi>+   score += bonus;
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 10
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 18 (strike)
</span></span><span class=line><span class=cl>    bonus = rolls.get(frameIndex + 1); // roll 19 (strike bonus)
</span></span><span class=line><span class=cl>    bonus += rolls.get(frameIndex + 2); // roll 20 (strike bonus)
</span></span><span class=line><span class=cl>    score += bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    return score;
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><blockquote><ul><li>Novice : Génial ! Dans chaque bloc, on a une ligne qui se ressemble. Mais le bonus se calcule toujours différement&mldr;</li><li>Expert : C&rsquo;est vrai, après la clarification, mettons en évidence la duplication</li><li>Novice : Pas facile&mldr;</li><li>Expert : Dans quel cas le bonus est équivalent au prochain lancer ?</li><li>Novice : Lorsqu&rsquo;on fait un spare</li><li>Expert : Et dans quel cas le bonus vaut les deux prochains lancers ?</li><li>Novice : Lors d&rsquo;un strike !</li><li>Expert : Et pour un bonus de zéro ?</li><li>Novice : Dans les autres cas !</li></ul></blockquote><p>Pour détecter un <em>strike</em>, il faut vérifier la somme du premier lancer. S&rsquo;il vaut <code>10</code>, c&rsquo;en est un. Pour un <em>spare</em>, c&rsquo;est la somme des deux lancers qui doit valoir <code>10</code>. Dans les autres cas, on n&rsquo;a pas de bonus (ou un bonus qui vaut <code>0</code>).</p><p>Mettons en évidence la duplication :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>public int score() {
</span></span><span class=line><span class=cl>    int score = 0;
</span></span><span class=line><span class=cl>    int frameIndex = 0;
</span></span><span class=line><span class=cl>    int bonus = 0;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 1
</span></span><span class=line><span class=cl>    frameIndex = 0;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 1
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 2
</span></span><span class=line><span class=cl><span class=gd>-   bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus += rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gi>+   } else if (rolls.get(frameIndex) + rolls.get(frameIndex + 1) == 10)
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gi>+   else
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 2
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 3
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 4
</span></span><span class=line><span class=cl><span class=gd>-   bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus += rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gi>+   } else if (rolls.get(frameIndex) + rolls.get(frameIndex + 1) == 10)
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gi>+   else
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 3
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 5
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 6 (spare)
</span></span><span class=line><span class=cl><span class=gd>-   bonus = rolls.get(frameIndex + 2); // roll 7 (spare bonus)
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus += rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gi>+   } else if (rolls.get(frameIndex) + rolls.get(frameIndex + 1) == 10)
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gi>+   else
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 4
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 7
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 8
</span></span><span class=line><span class=cl><span class=gd>-   bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus += rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gi>+   } else if (rolls.get(frameIndex) + rolls.get(frameIndex + 1) == 10)
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gi>+   else
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 5
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 9
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 10
</span></span><span class=line><span class=cl><span class=gd>-   bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus += rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gi>+   } else if (rolls.get(frameIndex) + rolls.get(frameIndex + 1) == 10)
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gi>+   else
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 6
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 11
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 12
</span></span><span class=line><span class=cl><span class=gd>-   bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus += rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gi>+   } else if (rolls.get(frameIndex) + rolls.get(frameIndex + 1) == 10)
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gi>+   else
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 7
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 13
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 14 (spare)
</span></span><span class=line><span class=cl><span class=gd>-   bonus = rolls.get(frameIndex + 2); // roll 15 (spare bonus)
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus += rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gi>+   } else if (rolls.get(frameIndex) + rolls.get(frameIndex + 1) == 10)
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gi>+   else
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 8
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 15 (strike)
</span></span><span class=line><span class=cl><span class=gd>-   bonus = rolls.get(frameIndex + 1); // roll 16 (strike bonus)
</span></span></span><span class=line><span class=cl><span class=gd>-   bonus += rolls.get(frameIndex + 2); // roll 17 (strike bonus)
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus += rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gi>+   } else if (rolls.get(frameIndex) + rolls.get(frameIndex + 1) == 10)
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gi>+   else
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 9
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 1;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 16
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 17
</span></span><span class=line><span class=cl><span class=gd>-   bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus += rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gi>+   } else if (rolls.get(frameIndex) + rolls.get(frameIndex + 1) == 10)
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gi>+   else
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 10
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 18 (strike)
</span></span><span class=line><span class=cl><span class=gd>-   bonus = rolls.get(frameIndex + 1); // roll 19 (strike bonus)
</span></span></span><span class=line><span class=cl><span class=gd>-   bonus += rolls.get(frameIndex + 2); // roll 20 (strike bonus)
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus += rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gi>+   } else if (rolls.get(frameIndex) + rolls.get(frameIndex + 1) == 10)
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gi>+   else
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gi></span>    score += bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    return score;
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><blockquote><ul><li>Novice : Le code est beaucoup plus lourd comme ça&mldr;</li><li>Expert : C&rsquo;est vrai. On peut le simplfiier en ajoutant une abstraction sur le calcul du bonus.</li><li>Novice : Comment peut-on faire ça ?</li><li>Expert : C&rsquo;est simple, avec le refactoring extract method.</li></ul></blockquote><p>Nous sommes assez avancés pour extraire le concept de calcul de bonus. Pour cela, nous allons faire un <a href=/wiki/extract-method rel=noopener class=internal-link data-src=/wiki/extract-method>extract method</a>. Cela consiste à créer une fonction à partir d&rsquo;un bloc de code.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>public int score() {
</span></span><span class=line><span class=cl>    int score = 0;
</span></span><span class=line><span class=cl>    int frameIndex = 0;
</span></span><span class=line><span class=cl>    int bonus = 0;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 1
</span></span><span class=line><span class=cl>    frameIndex = 0;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 1
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 2
</span></span><span class=line><span class=cl><span class=gi>+   bonus = calculateFrameBonus(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus += rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gd>-   } else if (rolls.get(frameIndex) + rolls.get(frameIndex + 1) == 10)
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gd>-   else
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gd></span>    score += bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 2
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 3
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 4
</span></span><span class=line><span class=cl><span class=gi>+   bonus = calculateFrameBonus(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus += rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gd>-   } else if (rolls.get(frameIndex) + rolls.get(frameIndex + 1) == 10)
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gd>-   else
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gd></span>    score += bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 3
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 5
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 6 (spare)
</span></span><span class=line><span class=cl><span class=gi>+   bonus = calculateFrameBonus(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus += rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gd>-   } else if (rolls.get(frameIndex) + rolls.get(frameIndex + 1) == 10)
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gd>-   else
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gd></span>    score += bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 4
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 7
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 8
</span></span><span class=line><span class=cl><span class=gi>+   bonus = calculateFrameBonus(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus += rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gd>-   } else if (rolls.get(frameIndex) + rolls.get(frameIndex + 1) == 10)
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gd>-   else
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gd></span>    score += bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 5
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 9
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 10
</span></span><span class=line><span class=cl><span class=gi>+   bonus = calculateFrameBonus(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus += rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gd>-   } else if (rolls.get(frameIndex) + rolls.get(frameIndex + 1) == 10)
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gd>-   else
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gd></span>    score += bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 6
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 11
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 12
</span></span><span class=line><span class=cl><span class=gi>+   bonus = calculateFrameBonus(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus += rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gd>-   } else if (rolls.get(frameIndex) + rolls.get(frameIndex + 1) == 10)
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gd>-   else
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gd></span>    score += bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 7
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 13
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 14 (spare)
</span></span><span class=line><span class=cl><span class=gi>+   bonus = calculateFrameBonus(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus += rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gd>-   } else if (rolls.get(frameIndex) + rolls.get(frameIndex + 1) == 10)
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gd>-   else
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gd></span>    score += bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 8
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 15 (strike)
</span></span><span class=line><span class=cl><span class=gi>+   bonus = calculateFrameBonus(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus += rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gd>-   } else if (rolls.get(frameIndex) + rolls.get(frameIndex + 1) == 10)
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gd>-   else
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gd></span>    score += bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 9
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 1;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 16
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex + 1); // roll 17
</span></span><span class=line><span class=cl><span class=gi>+   bonus = calculateFrameBonus(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus += rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gd>-   } else if (rolls.get(frameIndex) + rolls.get(frameIndex + 1) == 10)
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gd>-   else
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gd></span>    score += bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 10
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    score += rolls.get(frameIndex); // roll 18 (strike)
</span></span><span class=line><span class=cl><span class=gi>+   bonus = calculateFrameBonus(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus += rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gd>-   } else if (rolls.get(frameIndex) + rolls.get(frameIndex + 1) == 10)
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gd>-   else
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gd></span>    score += bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    return score;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=gi>+public int calculateFrameBonus(int frameIndex) {
</span></span></span><span class=line><span class=cl><span class=gi>+   int bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus += rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gi>+   } else if (rolls.get(frameIndex) + rolls.get(frameIndex + 1) == 10)
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = rolls.get(frameIndex + 2);
</span></span></span><span class=line><span class=cl><span class=gi>+   else
</span></span></span><span class=line><span class=cl><span class=gi>+       bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gi>+   return bonus;
</span></span></span><span class=line><span class=cl><span class=gi>+}
</span></span></span></code></pre></td></tr></table></div></div><blockquote><ul><li>Novice : 70 lignes de moins dans la fonction <code>score</code> !</li><li>Expert : Et ce n&rsquo;est que le début.</li><li>Novice : Je pense qu&rsquo;on va faire la même chose pour le calcul du score sans le bonus.</li><li>Expert : Bingo, on va encore perdre des lignes, mais que doit-on faire d&rsquo;abord ?</li><li>Novice : Mettre en évidence le concept puis la duplication.</li></ul></blockquote><p>Le calcul du score (sans le bonus) peut se faire de plusieurs manières différentes. J&rsquo;ai choisi l&rsquo;approche de faire le moins de modification possible dans le code actuel (pour les <em>strikes</em> et les <em>spares</em>, il aurait été possible de calculer directement 10).</p><p>Ici, nous allons calculer la somme d&rsquo;un lancer dans le cas d&rsquo;un strike et la somme de deux lancers dans les autres cas.</p><p>Mettons en évidence le concept de score lié à la frame :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>
</span></span><span class=line><span class=cl>public int score() {
</span></span><span class=line><span class=cl>    int score = 0;
</span></span><span class=line><span class=cl>    int frameIndex = 0;
</span></span><span class=line><span class=cl>    int bonus = 0;
</span></span><span class=line><span class=cl><span class=gi>+   int frameScore = 0;
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl>    // frame 1
</span></span><span class=line><span class=cl>    frameIndex = 0;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=gi>+   frameScore = rolls.get(frameIndex); // roll 1
</span></span></span><span class=line><span class=cl><span class=gi>+   frameScore += rolls.get(frameIndex + 1); // roll 2
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   score += rolls.get(frameIndex); // roll 1
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(frameIndex + 1); // roll 2
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl><span class=gi>+   score += frameScore + bonus;
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   score += bonus;
</span></span></span><span class=line><span class=cl><span class=gd></span>
</span></span><span class=line><span class=cl>    // frame 2
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl><span class=gi>+   frameScore = rolls.get(frameIndex); // roll 3
</span></span></span><span class=line><span class=cl><span class=gi>+   frameScore += rolls.get(frameIndex + 1); // roll 4
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   score += rolls.get(frameIndex); // roll 3
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(frameIndex + 1); // roll 4
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl><span class=gi>+   score += frameScore + bonus;
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   score += bonus;
</span></span></span><span class=line><span class=cl><span class=gd></span>
</span></span><span class=line><span class=cl>    // frame 3
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl><span class=gi>+   frameScore = rolls.get(frameIndex); // roll 5
</span></span></span><span class=line><span class=cl><span class=gi>+   frameScore += rolls.get(frameIndex + 1); // roll 6 (spare)
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   score += rolls.get(frameIndex); // roll 5
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(frameIndex + 1); // roll 6 (spare)
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl><span class=gi>+   score += frameScore + bonus;
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   score += bonus;
</span></span></span><span class=line><span class=cl><span class=gd></span>
</span></span><span class=line><span class=cl>    // frame 4
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl><span class=gi>+   frameScore = rolls.get(frameIndex); // roll 7
</span></span></span><span class=line><span class=cl><span class=gi>+   frameScore += rolls.get(frameIndex + 1); // roll 8
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   score += rolls.get(frameIndex); // roll 7
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(frameIndex + 1); // roll 8
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl><span class=gi>+   score += frameScore + bonus;
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   score += bonus;
</span></span></span><span class=line><span class=cl><span class=gd></span>
</span></span><span class=line><span class=cl>    // frame 5
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl><span class=gi>+   frameScore = rolls.get(frameIndex); // roll 9
</span></span></span><span class=line><span class=cl><span class=gi>+   frameScore += rolls.get(frameIndex + 1); // roll 10
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   score += rolls.get(frameIndex); // roll 9
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(frameIndex + 1); // roll 10
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl><span class=gi>+   score += frameScore + bonus;
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   score += bonus;
</span></span></span><span class=line><span class=cl><span class=gd></span>
</span></span><span class=line><span class=cl>    // frame 6
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl><span class=gi>+   frameScore = rolls.get(frameIndex); // roll 11
</span></span></span><span class=line><span class=cl><span class=gi>+   frameScore += rolls.get(frameIndex + 1); // roll 12
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   score += rolls.get(frameIndex); // roll 11
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(frameIndex + 1); // roll 12
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl><span class=gi>+   score += frameScore + bonus;
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   score += bonus;
</span></span></span><span class=line><span class=cl><span class=gd></span>
</span></span><span class=line><span class=cl>    // frame 7
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl><span class=gi>+   frameScore = rolls.get(frameIndex); // roll 13
</span></span></span><span class=line><span class=cl><span class=gi>+   frameScore += rolls.get(frameIndex + 1); // roll 14 (spare)
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   score += rolls.get(frameIndex); // roll 13
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(frameIndex + 1); // roll 14 (spare)
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl><span class=gi>+   score += frameScore + bonus;
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   score += bonus;
</span></span></span><span class=line><span class=cl><span class=gd></span>
</span></span><span class=line><span class=cl>    // frame 8
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl><span class=gi>+       frameScore = rolls.get(frameIndex); // roll 15 (strike)
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   score += rolls.get(frameIndex); // roll 15 (strike)
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl><span class=gi>+   score += frameScore + bonus;
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   score += bonus;
</span></span></span><span class=line><span class=cl><span class=gd></span>
</span></span><span class=line><span class=cl>    // frame 9
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 1;
</span></span><span class=line><span class=cl><span class=gi>+   frameScore = rolls.get(frameIndex); // roll 16
</span></span></span><span class=line><span class=cl><span class=gi>+   frameScore += rolls.get(frameIndex + 1); // roll 17
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   score += rolls.get(frameIndex); // roll 16
</span></span></span><span class=line><span class=cl><span class=gd>-   score += rolls.get(frameIndex + 1); // roll 17
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl><span class=gi>+   score += frameScore + bonus;
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   score += bonus;
</span></span></span><span class=line><span class=cl><span class=gd></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 10
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl><span class=gi>+   frameScore = rolls.get(frameIndex); // roll 18 (strike)
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   score += rolls.get(frameIndex); // roll 18 (strike)
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl><span class=gi>+   score += frameScore + bonus;
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   score += bonus;
</span></span></span><span class=line><span class=cl><span class=gd></span>
</span></span><span class=line><span class=cl>    return score;
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>Ensuite, on met en évidence la duplication :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>public int score() {
</span></span><span class=line><span class=cl>    int score = 0;
</span></span><span class=line><span class=cl>    int frameIndex = 0;
</span></span><span class=line><span class=cl>    int bonus = 0;
</span></span><span class=line><span class=cl>    int frameScore = 0;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 1
</span></span><span class=line><span class=cl>    frameIndex = 0;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi>+   } else {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore += rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gi>+   }
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   frameScore = rolls.get(frameIndex); // roll 1
</span></span></span><span class=line><span class=cl><span class=gd>-   frameScore += rolls.get(frameIndex + 1); // roll 2
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 2
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi>+   } else {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore += rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gi>+   }
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   frameScore = rolls.get(frameIndex); // roll 3
</span></span></span><span class=line><span class=cl><span class=gd>-   frameScore += rolls.get(frameIndex + 1); // roll 4
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 3
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi>+   } else {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore += rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gi>+   }
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   frameScore = rolls.get(frameIndex); // roll 5
</span></span></span><span class=line><span class=cl><span class=gd>-   frameScore += rolls.get(frameIndex + 1); // roll 6 (spare)
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 4
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi>+   } else {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore += rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gi>+   }
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   frameScore = rolls.get(frameIndex); // roll 7
</span></span></span><span class=line><span class=cl><span class=gd>-   frameScore += rolls.get(frameIndex + 1); // roll 8
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 5
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi>+   } else {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore += rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gi>+   }
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   frameScore = rolls.get(frameIndex); // roll 9
</span></span></span><span class=line><span class=cl><span class=gd>-   frameScore += rolls.get(frameIndex + 1); // roll 10
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 6
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi>+   } else {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore += rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gi>+   }
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   frameScore = rolls.get(frameIndex); // roll 11
</span></span></span><span class=line><span class=cl><span class=gd>-   frameScore += rolls.get(frameIndex + 1); // roll 12
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 7
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi>+   } else {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore += rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gi>+   }
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   frameScore = rolls.get(frameIndex); // roll 13
</span></span></span><span class=line><span class=cl><span class=gd>-   frameScore += rolls.get(frameIndex + 1); // roll 14 (spare)
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 8
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi>+   } else {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore += rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gi>+   }
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   frameScore = rolls.get(frameIndex); // roll 15 (strike)
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 9
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 1;
</span></span><span class=line><span class=cl><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi>+   } else {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore += rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gi>+   }
</span></span></span><span class=line><span class=cl><span class=gi></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 10
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi>+   } else {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi>+       frameScore += rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gi>+   }
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   frameScore = rolls.get(frameIndex); // roll 18 (strike)
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    return score;
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>Puis on la supprimons avec un <a href=/wiki/extract-method rel=noopener class=internal-link data-src=/wiki/extract-method>extract method</a> :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>public int score() {
</span></span><span class=line><span class=cl>    int score = 0;
</span></span><span class=line><span class=cl>    int frameIndex = 0;
</span></span><span class=line><span class=cl>    int bonus = 0;
</span></span><span class=line><span class=cl>    int frameScore = 0;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 1
</span></span><span class=line><span class=cl>    frameIndex = 0;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=gi>+   frameScore = calculateFrameScore(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   } else {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore += rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gd>-   }
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 2
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl><span class=gi>+   frameScore = calculateFrameScore(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   } else {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore += rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gd>-   }
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 3
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl><span class=gi>+   frameScore = calculateFrameScore(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   } else {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore += rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gd>-   }
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 4
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl><span class=gi>+   frameScore = calculateFrameScore(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   } else {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore += rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gd>-   }
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 5
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl><span class=gi>+   frameScore = calculateFrameScore(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   } else {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore += rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gd>-   }
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 6
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl><span class=gi>+   frameScore = calculateFrameScore(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   } else {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore += rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gd>-   }
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 7
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl><span class=gi>+   frameScore = calculateFrameScore(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   } else {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore += rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gd>-   }
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 8
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl><span class=gi>+   frameScore = calculateFrameScore(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   } else {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore += rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gd>-   }
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 9
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 1;
</span></span><span class=line><span class=cl><span class=gi>+   frameScore = calculateFrameScore(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   } else {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore += rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gd>-   }
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 10
</span></span><span class=line><span class=cl>    frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl><span class=gi>+   frameScore = calculateFrameScore(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   } else {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore = rolls.get(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-       frameScore += rolls.get(frameIndex + 1);
</span></span></span><span class=line><span class=cl><span class=gd>-   }
</span></span></span><span class=line><span class=cl><span class=gd></span>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    return score;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=gi>+private int calculateFrameScore(int frameIndex) {  
</span></span></span><span class=line><span class=cl><span class=gi>+    int frameScore;  
</span></span></span><span class=line><span class=cl><span class=gi>+    if (rolls.get(frameIndex) == 10) {  
</span></span></span><span class=line><span class=cl><span class=gi>+        frameScore = rolls.get(frameIndex);  
</span></span></span><span class=line><span class=cl><span class=gi>+    } else {  
</span></span></span><span class=line><span class=cl><span class=gi>+        frameScore = rolls.get(frameIndex);  
</span></span></span><span class=line><span class=cl><span class=gi>+        frameScore += rolls.get(frameIndex + 1);  
</span></span></span><span class=line><span class=cl><span class=gi>+    }  
</span></span></span><span class=line><span class=cl><span class=gi>+    return frameScore;  
</span></span></span><span class=line><span class=cl><span class=gi>+}+
</span></span></span></code></pre></td></tr></table></div></div><blockquote><ul><li>Novice : Il reste encore un concept, l&rsquo;indice de la prochaine frame. C&rsquo;est ça ?</li><li>Expert : Tout à fait. Tu commences à comprendre :)</li><li>Novice : Alors, le concept existe déjà, on va donc mettre en évidence la duplication puis la supprimer avec un extract method.</li><li>Expert : Bingo !</li></ul></blockquote><p>Voilà la mise en évidence :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>public int score() {
</span></span><span class=line><span class=cl>    int score = 0;
</span></span><span class=line><span class=cl>    int frameIndex = 0;
</span></span><span class=line><span class=cl>    int bonus = 0;
</span></span><span class=line><span class=cl>    int frameScore = 0;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 1
</span></span><span class=line><span class=cl>	frameIndex = 0;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 2
</span></span><span class=line><span class=cl><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameIndex = frameIndex + 1;
</span></span></span><span class=line><span class=cl><span class=gi>+   } else {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gi>+   }
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 3
</span></span><span class=line><span class=cl><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameIndex = frameIndex + 1;
</span></span></span><span class=line><span class=cl><span class=gi>+   } else {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gi>+   }
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 4
</span></span><span class=line><span class=cl><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameIndex = frameIndex + 1;
</span></span></span><span class=line><span class=cl><span class=gi>+   } else {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gi>+   }
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 5
</span></span><span class=line><span class=cl><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameIndex = frameIndex + 1;
</span></span></span><span class=line><span class=cl><span class=gi>+   } else {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gi>+   }
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 6
</span></span><span class=line><span class=cl><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameIndex = frameIndex + 1;
</span></span></span><span class=line><span class=cl><span class=gi>+   } else {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gi>+   }
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 7
</span></span><span class=line><span class=cl><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameIndex = frameIndex + 1;
</span></span></span><span class=line><span class=cl><span class=gi>+   } else {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gi>+   }
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 8
</span></span><span class=line><span class=cl><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameIndex = frameIndex + 1;
</span></span></span><span class=line><span class=cl><span class=gi>+   } else {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gi>+   }
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 9
</span></span><span class=line><span class=cl><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameIndex = frameIndex + 1;
</span></span></span><span class=line><span class=cl><span class=gi>+   } else {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gi>+   }
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   frameIndex = frameIndex + 1;
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 10
</span></span><span class=line><span class=cl><span class=gi>+   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameIndex = frameIndex + 1;
</span></span></span><span class=line><span class=cl><span class=gi>+   } else {
</span></span></span><span class=line><span class=cl><span class=gi>+       frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gi>+   }
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    return score;
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>Et la suppression avec un <a href=/wiki/extract-method rel=noopener class=internal-link data-src=/wiki/extract-method>extract method</a> :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>public int score() {
</span></span><span class=line><span class=cl>    int score = 0;
</span></span><span class=line><span class=cl>    int frameIndex = 0;
</span></span><span class=line><span class=cl>    int bonus = 0;
</span></span><span class=line><span class=cl>    int frameScore = 0;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 1
</span></span><span class=line><span class=cl>    frameIndex = 0;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 2
</span></span><span class=line><span class=cl><span class=gi>+   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameIndex = frameIndex + 1;
</span></span></span><span class=line><span class=cl><span class=gd>-   } else {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gd>-   }
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 3
</span></span><span class=line><span class=cl><span class=gi>+   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameIndex = frameIndex + 1;
</span></span></span><span class=line><span class=cl><span class=gd>-   } else {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gd>-   }
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 4
</span></span><span class=line><span class=cl><span class=gi>+   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameIndex = frameIndex + 1;
</span></span></span><span class=line><span class=cl><span class=gd>-   } else {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gd>-   }
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 5
</span></span><span class=line><span class=cl><span class=gi>+   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameIndex = frameIndex + 1;
</span></span></span><span class=line><span class=cl><span class=gd>-   } else {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gd>-   }
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 6
</span></span><span class=line><span class=cl><span class=gi>+   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameIndex = frameIndex + 1;
</span></span></span><span class=line><span class=cl><span class=gd>-   } else {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gd>-   }
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 7
</span></span><span class=line><span class=cl><span class=gi>+   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameIndex = frameIndex + 1;
</span></span></span><span class=line><span class=cl><span class=gd>-   } else {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gd>-   }
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 8
</span></span><span class=line><span class=cl><span class=gi>+   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameIndex = frameIndex + 1;
</span></span></span><span class=line><span class=cl><span class=gd>-   } else {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gd>-   }
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 9
</span></span><span class=line><span class=cl><span class=gi>+   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameIndex = frameIndex + 1;
</span></span></span><span class=line><span class=cl><span class=gd>-   } else {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gd>-   }
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 10
</span></span><span class=line><span class=cl><span class=gi>+   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameIndex = frameIndex + 1;
</span></span></span><span class=line><span class=cl><span class=gd>-   } else {
</span></span></span><span class=line><span class=cl><span class=gd>-       frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gd>-   }
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    return score;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=gi>+private int nextFrame(int frameIndex) {
</span></span></span><span class=line><span class=cl><span class=gi>+    if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gi>+        frameIndex = frameIndex + 1;
</span></span></span><span class=line><span class=cl><span class=gi>+    } else {
</span></span></span><span class=line><span class=cl><span class=gi>+        frameIndex = frameIndex + 2;
</span></span></span><span class=line><span class=cl><span class=gi>+    }
</span></span></span><span class=line><span class=cl><span class=gi>+    return frameIndex;
</span></span></span><span class=line><span class=cl><span class=gi>+}
</span></span></span></code></pre></td></tr></table></div></div><blockquote><ul><li>Novice : Et maintenant, la boucle !!!!!</li><li>Expert : Presque, il y a encore une chose qui ne colle pas.</li><li>Novice : ???</li><li>Expert : Tous les blocs de codes sont identiques, sauf pour le frame 1</li><li>Novice : Oui, c&rsquo;est vrai, on n&rsquo;a qu&rsquo;à faire un cas particulier pour ce bloc.</li><li>Expert : Ou alors, on l&rsquo;aligne avec les autres</li><li>Novice : ???</li><li>Expert : Tu vas voir</li></ul></blockquote><p>Pour rendre le code identique, on supprime tout simplement l&rsquo;initialisation de <code>frameIndex</code> qui est déjà fait (on aurait pu la supprimer depuis longtemps).</p><p>Ensuite, sans cette initialisation, il n&rsquo;y a pas de calcul de <code>frameIndex</code> dans le premier bloc, on déplace donc le calcul du deuxième bloc pour l&rsquo;associer au premier bloc. On fait ainsi pour chaque bloc.</p><p>Enfin, on se rend compte que le dixième bloc est différent des autres. On lui ajoute un <code>nextFrame</code> et on lance les tests pour voir si cette ligne supplémentaire ne casse rien.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>public int score() {
</span></span><span class=line><span class=cl>    int score = 0;
</span></span><span class=line><span class=cl>    int frameIndex = 0;
</span></span><span class=line><span class=cl>    int bonus = 0;
</span></span><span class=line><span class=cl>    int frameScore = 0;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 1
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = 0;
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl><span class=gi>+   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl>    // frame 2
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl><span class=gi>+   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl>    // frame 3
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl><span class=gi>+   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl>    // frame 4
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl><span class=gi>+   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl>    // frame 5
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl><span class=gi>+   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl>    // frame 6
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl><span class=gi>+   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl>    // frame 7
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl><span class=gi>+   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl>    // frame 8
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl><span class=gi>+   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl>    // frame 9
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl><span class=gi>+   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl>    // frame 10
</span></span><span class=line><span class=cl><span class=gd>-   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd></span>    frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>    bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>    score += frameScore + bonus;
</span></span><span class=line><span class=cl><span class=gi>+   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span>    
</span></span><span class=line><span class=cl>    return score;
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><blockquote><ul><li>Novice : On peut enfin passer à la boucle ?</li><li>Expert : Ouiiiii ! Tous nos blocs sont identiques.</li></ul></blockquote><p>Notre code traite 10 frames. On va donc utiliser un compteur qui va jusqu&rsquo;à 10 :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>public int score() {
</span></span><span class=line><span class=cl>    int score = 0;
</span></span><span class=line><span class=cl>    int frameIndex = 0;
</span></span><span class=line><span class=cl>    int bonus = 0;
</span></span><span class=line><span class=cl>    int frameScore = 0;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=gd>-	// frame 1    
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   for (int frame = 0; frame &lt; 10; frame++) {
</span></span></span><span class=line><span class=cl><span class=gi></span>        frameScore = calculateFrameScore(frameIndex);
</span></span><span class=line><span class=cl>        bonus = calculateFrameBonus(frameIndex);
</span></span><span class=line><span class=cl>        score += frameScore + bonus;
</span></span><span class=line><span class=cl>        frameIndex = nextFrame(frameIndex);
</span></span><span class=line><span class=cl><span class=gi>+   }
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   // frame 2
</span></span></span><span class=line><span class=cl><span class=gd>-   frameScore = calculateFrameScore(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   bonus = calculateFrameBonus(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   score += frameScore + bonus;
</span></span></span><span class=line><span class=cl><span class=gd>-   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd></span>
</span></span><span class=line><span class=cl><span class=gd>-   // frame 3
</span></span></span><span class=line><span class=cl><span class=gd>-   frameScore = calculateFrameScore(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   bonus = calculateFrameBonus(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   score += frameScore + bonus;
</span></span></span><span class=line><span class=cl><span class=gd>-   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd></span>
</span></span><span class=line><span class=cl><span class=gd>-   // frame 4
</span></span></span><span class=line><span class=cl><span class=gd>-   frameScore = calculateFrameScore(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   bonus = calculateFrameBonus(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   score += frameScore + bonus;
</span></span></span><span class=line><span class=cl><span class=gd>-   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd></span>
</span></span><span class=line><span class=cl><span class=gd>-   // frame 5
</span></span></span><span class=line><span class=cl><span class=gd>-   frameScore = calculateFrameScore(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   bonus = calculateFrameBonus(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   score += frameScore + bonus;
</span></span></span><span class=line><span class=cl><span class=gd>-   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd></span>
</span></span><span class=line><span class=cl><span class=gd>-   // frame 6
</span></span></span><span class=line><span class=cl><span class=gd>-   frameScore = calculateFrameScore(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   bonus = calculateFrameBonus(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   score += frameScore + bonus;
</span></span></span><span class=line><span class=cl><span class=gd>-   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd></span>
</span></span><span class=line><span class=cl><span class=gd>-   // frame 7
</span></span></span><span class=line><span class=cl><span class=gd>-   frameScore = calculateFrameScore(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   bonus = calculateFrameBonus(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   score += frameScore + bonus;
</span></span></span><span class=line><span class=cl><span class=gd>-   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd></span>
</span></span><span class=line><span class=cl><span class=gd>-   // frame 8
</span></span></span><span class=line><span class=cl><span class=gd>-   frameScore = calculateFrameScore(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   bonus = calculateFrameBonus(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   score += frameScore + bonus;
</span></span></span><span class=line><span class=cl><span class=gd>-   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd></span>
</span></span><span class=line><span class=cl><span class=gd>-   // frame 9
</span></span></span><span class=line><span class=cl><span class=gd>-   frameScore = calculateFrameScore(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   bonus = calculateFrameBonus(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   score += frameScore + bonus;
</span></span></span><span class=line><span class=cl><span class=gd>-   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd></span>
</span></span><span class=line><span class=cl><span class=gd>-   // frame 10
</span></span></span><span class=line><span class=cl><span class=gd>-   frameScore = calculateFrameScore(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   bonus = calculateFrameBonus(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-   score += frameScore + bonus;
</span></span></span><span class=line><span class=cl><span class=gd>-   frameIndex = nextFrame(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd></span>
</span></span><span class=line><span class=cl>    return score;
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>La portée de nos variables peut être diminuée :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>public int score() {
</span></span><span class=line><span class=cl>    int score = 0;
</span></span><span class=line><span class=cl>    int frameIndex = 0;
</span></span><span class=line><span class=cl><span class=gd>-   int bonus = 0;
</span></span></span><span class=line><span class=cl><span class=gd>-   int frameScore = 0;
</span></span></span><span class=line><span class=cl><span class=gd></span>
</span></span><span class=line><span class=cl>    // frame 1
</span></span><span class=line><span class=cl>    for (int frame = 0; frame &lt; 10; frame++) {
</span></span><span class=line><span class=cl><span class=gi>+       int frameScore = calculateFrameScore(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi>+       int bonus = calculateFrameBonus(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-       frameScore = calculateFrameScore(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-       bonus = calculateFrameBonus(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd></span>        score += frameScore + bonus;
</span></span><span class=line><span class=cl>        frameIndex = nextFrame(frameIndex);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    return score;
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>Les méthodes sont aussi parlantes que nos variables, on peut donc les supprimer :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>public int score() {
</span></span><span class=line><span class=cl>    int score = 0;
</span></span><span class=line><span class=cl>    int frameIndex = 0;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // frame 1
</span></span><span class=line><span class=cl>    for (int frame = 0; frame &lt; 10; frame++) {
</span></span><span class=line><span class=cl><span class=gi>+       score += calculateFrameScore(frameIndex) + calculateFrameBonus(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-       int frameScore = calculateFrameScore(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-       int bonus = calculateFrameBonus(frameIndex);
</span></span></span><span class=line><span class=cl><span class=gd>-       score += frameScore + bonus;
</span></span></span><span class=line><span class=cl><span class=gd></span>        frameIndex = nextFrame(frameIndex);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    return score;
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>On peut simplifier la lecture en introduisant les concepts de strike et de spare :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>private int nextFrame(int frameIndex) {
</span></span><span class=line><span class=cl><span class=gi>+   if (isStrike(frameIndex)) {
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd></span>        frameIndex = frameIndex + 1;
</span></span><span class=line><span class=cl>    } else {
</span></span><span class=line><span class=cl>        frameIndex = frameIndex + 2;
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    return frameIndex;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>private int calculateFrameScore(int frameIndex) {
</span></span><span class=line><span class=cl>    int frameScore;
</span></span><span class=line><span class=cl><span class=gi>+   if (isStrike(frameIndex)) {
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd></span>        frameScore = rolls.get(frameIndex);
</span></span><span class=line><span class=cl>    } else {
</span></span><span class=line><span class=cl>        frameScore = rolls.get(frameIndex);
</span></span><span class=line><span class=cl>        frameScore += rolls.get(frameIndex + 1);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    return frameScore;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>public int calculateFrameBonus(int frameIndex) {
</span></span><span class=line><span class=cl>    int bonus = 0;
</span></span><span class=line><span class=cl><span class=gi>+   if (isStrike(frameIndex)) {
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gd>-   if (rolls.get(frameIndex) == 10) {
</span></span></span><span class=line><span class=cl><span class=gd></span>        bonus = rolls.get(frameIndex + 1);
</span></span><span class=line><span class=cl>        bonus += rolls.get(frameIndex + 2);
</span></span><span class=line><span class=cl>    } else if (isSpare(frameIndex))
</span></span><span class=line><span class=cl><span class=gd>-   } else if (rolls.get(frameIndex) + rolls.get(frameIndex + 1) == 10)
</span></span></span><span class=line><span class=cl><span class=gd></span>        bonus = rolls.get(frameIndex + 2);
</span></span><span class=line><span class=cl>    else
</span></span><span class=line><span class=cl>        bonus = 0;
</span></span><span class=line><span class=cl>    return bonus;
</span></span><span class=line><span class=cl><span class=gi>+}
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl><span class=gi>+private boolean isSpare(int frameIndex) {
</span></span></span><span class=line><span class=cl><span class=gi>+    return rolls.get(frameIndex) + rolls.get(frameIndex + 1) == 10;
</span></span></span><span class=line><span class=cl><span class=gi>+}
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl><span class=gi>+private boolean isStrike(int frameIndex) {
</span></span></span><span class=line><span class=cl><span class=gi>+   return rolls.get(frameIndex) == 10;
</span></span></span><span class=line><span class=cl><span class=gi>+}
</span></span></span></code></pre></td></tr></table></div></div><p>Et voilà ! Nous pourrions encore faire du refactoring, mais ce code fonctionne et je le trouve satisfaisant pour l&rsquo;exercice.</p><h2 id=la-classe-bowling->La classe Bowling :</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Bowling</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>    <span class=n>List</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>rolls</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>roll</span><span class=o>(</span><span class=kt>int</span> <span class=n>pins</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>        <span class=n>rolls</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>pins</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>    <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>score</span><span class=o>()</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>score</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>frameIndex</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>        <span class=c1>// frame 1  
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>frame</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=n>frame</span> <span class=o>&lt;</span> <span class=n>10</span><span class=o>;</span> <span class=n>frame</span><span class=o>++)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>            <span class=n>score</span> <span class=o>+=</span> <span class=n>calculateFrameScore</span><span class=o>(</span><span class=n>frameIndex</span><span class=o>)</span> <span class=o>+</span> <span class=n>calculateFrameBonus</span><span class=o>(</span><span class=n>frameIndex</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>            <span class=n>frameIndex</span> <span class=o>=</span> <span class=n>nextFrame</span><span class=o>(</span><span class=n>frameIndex</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>        <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>score</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>    <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=nf>nextFrame</span><span class=o>(</span><span class=kt>int</span> <span class=n>frameIndex</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>isStrike</span><span class=o>(</span><span class=n>frameIndex</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>frameIndex</span> <span class=o>=</span> <span class=n>frameIndex</span> <span class=o>+</span> <span class=n>1</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>            <span class=n>frameIndex</span> <span class=o>=</span> <span class=n>frameIndex</span> <span class=o>+</span> <span class=n>2</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>        <span class=o>}</span>  
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>frameIndex</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>    <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=nf>calculateFrameScore</span><span class=o>(</span><span class=kt>int</span> <span class=n>frameIndex</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>frameScore</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>isStrike</span><span class=o>(</span><span class=n>frameIndex</span><span class=o>))</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>            <span class=n>frameScore</span> <span class=o>=</span> <span class=n>rolls</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>frameIndex</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>            <span class=n>frameScore</span> <span class=o>=</span> <span class=n>rolls</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>frameIndex</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>            <span class=n>frameScore</span> <span class=o>+=</span> <span class=n>rolls</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>frameIndex</span> <span class=o>+</span> <span class=n>1</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>        <span class=o>}</span>  
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>frameScore</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>    <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>calculateFrameBonus</span><span class=o>(</span><span class=kt>int</span> <span class=n>frameIndex</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>bonus</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>isStrike</span><span class=o>(</span><span class=n>frameIndex</span><span class=o>))</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>            <span class=n>bonus</span> <span class=o>=</span> <span class=n>rolls</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>frameIndex</span> <span class=o>+</span> <span class=n>1</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>            <span class=n>bonus</span> <span class=o>+=</span> <span class=n>rolls</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>frameIndex</span> <span class=o>+</span> <span class=n>2</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>isSpare</span><span class=o>(</span><span class=n>frameIndex</span><span class=o>))</span>  
</span></span><span class=line><span class=cl>            <span class=n>bonus</span> <span class=o>=</span> <span class=n>rolls</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>frameIndex</span> <span class=o>+</span> <span class=n>2</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=n>bonus</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>bonus</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>    <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>isSpare</span><span class=o>(</span><span class=kt>int</span> <span class=n>frameIndex</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>rolls</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>frameIndex</span><span class=o>)</span> <span class=o>+</span> <span class=n>rolls</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>frameIndex</span> <span class=o>+</span> <span class=n>1</span><span class=o>)</span> <span class=o>==</span> <span class=n>10</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>    <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>isStrike</span><span class=o>(</span><span class=kt>int</span> <span class=n>frameIndex</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>rolls</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>frameIndex</span><span class=o>)</span> <span class=o>==</span> <span class=n>10</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>    <span class=o>}</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=conclusion>Conclusion</h2><p>J&rsquo;ai forcé la démonstration de la méthode en ne faisant qu&rsquo;un seul test. J&rsquo;ai mis de côté TDD pour me concentrer seulement sur le refactoring.</p><p>Bien sûr, cette méthode doit être couplée à TDD et il faut écrire les tests au fur et à mesure. Elle ne fonctionne pas dans tous les cas, mais tricher permet parfois d&rsquo;aller beaucoup plus vite.</p><p>Merci de m&rsquo;avoir lu jusqu&rsquo;au bout
<img src=/ alt></p><p><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.ytreza.dev%2fblog%2fetude-du-kata-bowling-one-test%2f &title=Etude%20du%20kata%20bowling%20%28en%20un%20seul%20test%29 &summary=Introduction%20Dans%20cette%20%c3%a9tude%20de%20kata%2c%20nous%20allons%20nous%20attarder%20sur%20une%20technique%20cl%c3%a9%20de%20TDD%2c%20la%20technique%20de%20la%20triche.&source=LinkedIn">Partager sur linkedin</a></p></article><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//www-ytreza-dev.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a><hr><div class=page-end><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://www.ytreza.dev/js/graph.27e8521c25c27c79dea35f434c486167.js></script>
<script>drawGraph("https://www.ytreza.dev/blog/etude-du-kata-bowling-one-test","https://www.ytreza.dev",[{"/moc":"#4388cc"}],-1,!0,!1,!0)</script></div></div><div id=contact_buttons><footer><p>Made by Jonathan LAURENT using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, © 2022</p><ul><li><a href=/>Home</a></li><li><a href=https://twitter.com/Johjo07>Twitter</a></li></ul></footer></div><script src=https://www.ytreza.dev/js/popover.e57188d2e4c06b0654e020b3a734bb62.min.js></script>
<script>initPopover("https://www.ytreza.dev")</script></div></body></html>